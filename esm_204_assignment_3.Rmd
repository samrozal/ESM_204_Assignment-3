---
title: "Distributional Consequences of Climate Policy- ESM 204 Assignment 3"
author: "Sam Rozal, Hollie Pennington, Abigail Sanford"
date: "May 12th, 2022"
output:
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rootSolve)
library(janitor)
library(here)
```

```{r}
df <- read_csv(here("data","HW3_data.csv")) %>% 
  select(-1) %>% 
  clean_names()
```
Last year, the Biden Administration assembled an Inter-agency Working Group (IWG) tasked withupdating the United States Government’s Social Cost of Carbon (SCC), which has not been comprehensively updated since 2010. The Administration has also called on government agencies to address environmental justice, racism, and equity concerns when considering policies designed to mitigate climate change.

While the Interagency Working Group develops a new SCC, the Biden Administration’s “interim” value is $51 per metric ton of CO2. The electricity sector is the second largest source of greenhouse gas emissions in the U.S. (after transportation). In this homework, you will consider the distributional consequences of imposing a household electricity tax based on the SCC to address the climate change problem.

We recommend using R and writing functions to compute your answers wherever possible. Use the following set of facts:

• Consumers can be separated into two income groups: “high” and “low.” The data set provides
price (in $) and quantity (in kWh) estimates of demand per month for the two groups. Run
linear regressions (with an intercept) to estimate the demand curves for “high” and “low”
income consumers.
• Initially, there is no tax on electricity consumption.
• The current electricity price (without any taxes) is $.10 per kWh.
• The marginal cost of producing a kWh of electricity is linear and has a price-intercept of 0.


# Question 1
1. One kWh of electricity emits 0.85 pounds of CO2. Assuming that the interim SCC correctly
reflects the total social cost of one metric ton of CO2, what is the marginal externality cost per kwH of electricity?

Unit conversion of lbs to tons

- (0.85lbs/1)(1ton/2204.62lbs) = 0.00038555397 tons

- Therefore, each kwh of electricity emits 0.00038555397 tons of carbon. 

Then calculate the social cost of carbon per kwh 

- (0.00038555397 tons of carbon/kwh)*($51/ metric ton of CO2)= 
  $0.0196632526/ton 
  
- The social cost of carbon per kwh is $0.02/ton

The marginal externality social cost of carbon per a kwh is $0.02/ton 


# Question 2
2. What is the aggregate monthly demand curve for electricity? What is
the supply curve for electricity? What is the “benefit” to consumers
under the status quo? What is the “benefit” to producers under the
status quo? What is the environmental cost under the status quo?

```{r}
model_demand_l <- lm(price_cents  ~ q_low_kwh, data=df)
model_demand_h <- lm(price_cents ~ q_high_kwh, data=df)
```

```{r}
summary(model_demand_l)
summary(model_demand_h)

```
Equation of line 

```{r}
# need to rearrange the parameter to get Q(P)! 
#Qgg = Qlow(P) + Qlow(h) 

# Importantly, since they-intercepts are different, we know that Qagg(P) will have a kink. I include an ifelse() statement to take
# care of the kink.
```


```{r}
# define a function to get demand

demand <- function(p, model){
  q <- (p - model$coefficients[[1]])/model$coefficients[[2]]
  q <- ifelse(q<0,0,q)
  return(q)
}
```


```{r}
# for each p level, return estimated aggregate demand
demand_agg <- function(p){
  q <- demand(p, model_demand_l) + demand(p, model_demand_h)
  return(q)
}
```


```{r}
demand_indv<- function(p, model){
  q <- (p - model$coefficients[[1]])/model$coefficients[[2]]
  return(q)
}
```

```{r}
price_low = seq(0, 23.3, length.out = 100)
demand_low <- demand_indv(price_low, model_demand_l)

low_demand <- map(price_low,demand_low) %>% unlist()

df_2 <- tibble(demand_low = demand_low, price_low = price_low)

ggplot(df_2, aes(demand_low, price_low)) +
  geom_line()
  
```

```{r}
price_high = seq(0, 31.6, length.out = 100)
demand_high <- demand_indv(price_high, model_demand_h)

high_demand <- map(price_high,demand_high) %>% unlist()

df_3 <- tibble(demand_high = demand_high, price_high = price_high)

ggplot(df_2, aes(demand_high, price_high)) +
  geom_line()
```


```{r}
price = seq(0, 31.6, length.out = 100)
Qagg <- map(price, demand_agg) %>% unlist()

df<- tibble(Qagg = Qagg, price = price)

ggplot(df, aes(Qagg, price)) +
  geom_line()

```
```{r}
ggplot() +
  geom_line(df, mapping=aes(Qagg, price, color = "blue"))+
  geom_line(df_2, mapping=aes(demand_low,price_low, color = "purple")) +
  geom_line(df_3, mapping=aes(demand_high,price_high, color = "red")) + 
  scale_color_manual(values = c('red', 'blue', 'purple')) +
  ylim(0,50) + 
  labs(x = "Quantity of Electricty (kWh)",
       y = "Price per kWh",
       title = "Monthly Demand Curve for Electricity") + 
  theme_minimal() + 
  theme(plot.title = element_text(hjust = 0.5))
```

```{r}
# I also define functions for calculating the consumer surplus:

CS <- function(p, model){
  q <- demand(p, model)
  cs <- 0.5*(model$coefficients[[1]] - p)*q
  return(cs)
}

CS_agg <- function(p){
  cs <- CS(p,model_demand_l) + CS(p,model_demand_h)
  return(cs)
}

```

